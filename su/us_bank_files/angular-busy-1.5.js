(function(window,angular,undefined){'use strict';angular.module('ngBusy.interceptor',[]).provider('busyInterceptor',function(){this.$get=['$rootScope','$q',function($rootScope,$q){var _total=0,_completed=0;function complete(){_total=_completed=0}
function handleResponse(r){if(r.config.notBusy)return;$rootScope.$broadcast('busy.end',{url:r.config.url,name:r.config.name,remaining:_total- ++_completed});if(_completed>=_total)complete()}
return{outstanding:function(){return _total-_completed},'request':function(config){if(!config.notBusy){$rootScope.$broadcast('busy.begin',{url:config.url,name:config.name});_total++}
return config||$q.when(config)},'response':function(response){handleResponse(response);return response},'responseError':function(rejection){handleResponse(rejection);return $q.reject(rejection)}}}]}).config(['$httpProvider',function($httpProvider){$httpProvider.interceptors.push('busyInterceptor')}]);angular.module('ngBusy.busy',[]).directive('busy',['$parse','$timeout',function($parse,$timeout){return{restrict:'A',tranclude:!0,scope:{},controller:['$scope',function($scope){this.setBusyMessageElement=function(element){$scope.busyMessageElement=element}}],link:function(scope,element,attrs){scope.isWidget=!1;attrs.$observe('busy',function(val){scope.busyMessage=val});attrs.$observe('busyWhenUrl',function(val){scope.busyWhenUrl=val});attrs.$observe('busyWhenName',function(val){scope.busyWhenName=val});attrs.$observe('busyAddClasses',function(val){scope.busyAddClasses=val});attrs.$observe('busyRemoveClasses',function(val){scope.busyRemoveClasses=val});attrs.$observe('busyDisabled',function(val){var parsed=$parse(val)(scope);scope.busyDisabled=angular.isDefined(parsed)?parsed:!0});attrs.$observe('notBusyWhenUrl',function(val){scope.notBusyWhenUrl=val});attrs.$observe('notBusyWhenName',function(val){scope.notBusyWhenName=val});attrs.$observe('notBusyAddClasses',function(val){scope.notBusyAddClasses=val});attrs.$observe('notBusyRemoveClasses',function(val){scope.notBusyRemoveClasses=val});attrs.$observe('notBusyDisabled',function(val){var parsed=$parse(val)(scope);scope.notBusyDisabled=angular.isDefined(parsed)?parsed:!1});scope.isBusyFor=function(config,begin){var key;if(scope[(key=begin?'busyWhenName':'notBusyWhenName')])return!!config.name&&!!config.name.match(scope[key]);else if(scope[(key=begin?'busyWhenUrl':'notBusyWhenUrl')])return!!config.url&&!!config.url.match(scope[key]);else return begin===!0||config.remaining<=0};scope.$on('attrUxRefresh',function(event,data){(data=='true'||data=='True')?scope.isWidget=!0:scope.isWidget=!1});scope.$on('busy.begin',function(evt,config){if(!scope.busy&&scope.isBusyFor(config,!0)){scope.originalContent=element.html();if(scope.busyDisabled)$timeout(function(){element.attr('disabled',!0)});var msgElement=scope.busyMessageElement?scope.busyMessageElement.clone():null;if(msgElement||scope.busyMessage)element.html('').append(msgElement||scope.busyMessage);element.removeClass(scope.busyRemoveClasses).addClass(scope.busyAddClasses);if(scope.isWidget===!0)
{angular.forEach(document.querySelectorAll('.tabDisableOnBusy'),function(v)
{angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','-1')})}
$('body').css('user-select','none');angular.forEach(document.querySelectorAll('input'),function(v){angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','-1')});angular.forEach(document.querySelectorAll('a'),function(v){angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','-1')});angular.forEach(document.querySelectorAll('button'),function(v){angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','-1')});$("#spinerSpan").text("We’re logging you in. It won’t take long.");$(".contentHolder").removeClass('hide');$(".spinner").attr('aria-busy','true');scope.busy=!0}});scope.$on('busy.end',function(evt,config){if(scope.busy&&scope.isBusyFor(config)){if(scope.originalContent)element.html(scope.originalContent);element.attr('disabled',scope.notBusyDisabled===!0);element.removeClass(scope.notBusyRemoveClasses).addClass(scope.notBusyAddClasses);if(scope.isWidget===!0)
{angular.forEach(document.querySelectorAll('.tabDisableOnBusy'),function(v){angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','0')})}
$('body').css('user-select','auto');angular.forEach(document.querySelectorAll('input'),function(v){angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','0')});angular.forEach(document.querySelectorAll('a'),function(v){angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','0')});angular.forEach(document.querySelectorAll('button'),function(v){angular.element(v).removeAttr('tabindex');angular.element(v).attr('tabindex','0')});$("#spinerSpan").text('');$(".spinner").attr('aria-busy','false');scope.busy=!1}})}}}]).directive('busyMessage',function(){return{restrict:'AE',transclude:!0,require:'^busy',template:'',replace:!0,compile:function(element,attr,transclude){return function link(scope,element,attr,busyCtrl){busyCtrl.setBusyMessageElement(transclude(scope,function(){}))}}}});angular.module('ngBusy',['ngBusy.interceptor','ngBusy.busy'])})(window,window.angular)