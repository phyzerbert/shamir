define(["jquery","xm/xm_api"],function(t,e){function i(t){M=t,y=M.loginConf,Object.assign(C,M.strings)}function n(t){return null!=C[t]?C[t]:t}function o(){var e="data-xmui-customstringtext";t("["+e+"]").each(function(i,o){o=t(o);var r=o.attr(e),a=n(r);o.text(a)}),["placeholder"].forEach(function(e){var i="data-xmui-customstringtext-"+e;t("["+i+"]").each(function(o,r){r=t(r);var a=r.attr(i),s=n(a);r.attr(e,s)})})}function r(t,e){var i=t.off||t.unbind;i.call(t,"click");var n=t.on||t.bind;n.call(t,"click",e)}function a(e,i){var n=t(".xmuiProgressForm"),r=t('<div class="xmuiCore xmuiForm xmuiEnrollmentForm" hidden style="display:none"><div class="xmuiPrompt" data-xmui-customstringtext="enroll.prompt"/><div class="xmuiFullHeightContentBelowPrompt"><img class="xmuiOtpImg"/><button type="button" data-xmui-customstringtext="enroll.continue"></button></div></div>'),a=r.find(".xmuiOtpImg"),s=r.find("button");return r.appendTo(i),o(),new Promise(function(i,o){n.hide(),a.attr("src","/xmwl/xm/eqc?"+t.param({uid:e})),s.click(function(){i({enrollment:"done"})}),r.fadeIn()})}function s(i,a,u){function d(){a.attr("aria-busy","true")}function c(){a.removeAttr("aria-busy")}function m(){it.attr("aria-busy","true"),it.attr("role","alert"),it.show()}function x(){it.removeAttr("aria-busy"),it.removeAttr("role"),it.hide()}function f(e,i){e.find(".xmuiPageHeader").remove();var n=t('<div class="xmuiPageHeader"><div><span></span><button role="button" data-xmui-customstringtext="login.cancelButton"></button></div></div>');n.find("span").text(i),e.prepend(n),o()}function v(t,e){var i=0;ne.forEach(function(n){n.fadeOut(function(){i+=1,i===ne.length&&t.fadeIn(function(){e&&e.focus()})})})}function h(e){var i=t('<div class="xmuiLoginTiles">');ne.forEach(function(t){t.appendTo(i)}),i.appendTo(e),o()}function g(i,o,r,a,s,u){return nt.attr("aria-hidden","false"),new Promise(function(l,d){function m(i,o,r){function a(t,e,i,o,r){t.attr("aria-label",n(i).replace("$name",e)),t.attr("role",o),t.attr("tabindex",r)}var u=i.annunciators||[],d=t("<div>").addClass("xmuiMenuItemAnnunciators").appendTo(o);return u.forEach(function(n){var o=t("<div>").addClass("xmuiMenuItemAnnunciator").addClass(n);if(s){var u={method:i.method.type};switch(n){case"xmuiMethodMenuAnnUnregister":u.action=e.ConfigMenuActions.Unregister,a(o,i.title,"aria.unregisterMethod","Button",r);break;case"xmuiMethodMenuAnnReRegister":u.action=e.ConfigMenuActions.Register,a(o,i.title,"aria.reRegisterMethod","Button",r);break;case"xmuiMehtodMenuAnnRegister":u.action=e.ConfigMenuActions.Register,a(o,i.title,"aria.registerMethod","Button",r);break;case"xmuiMethodMenuAnnLocked":a(o,i.title,"aria.lockedMethod","status",r);break;case"xmuiMehtodMenuAnnExpired":a(o,i.title,"aria.expiredMethod","status",r);break;case"xmuiMethodMenuAnnDefault":a(o,i.title,"aria.defaultMethod","status",r)}u.action&&o.click(function(){nt.attr("aria-hidden","true"),nt.fadeOut(function(){l(u)})})}o.html("&nbsp;"),d.append(o)}),o}nt.find(".xmuiMenuItems").empty(),a?(st.text(a),st.addClass("xmuiPromptError")):(st.text(r),st.removeClass("xmuiPromptError")),rt.text(o);var p=0;i.forEach(function(i){var o=t('<div class="xmuiMenuItem xmuiAuthenticatorMenuItem">'),r=t('<span class="xmuiMethodMenuItemText" role="button"></span>');r.text(i.title),o.append(r),i.classes.forEach(function(t){o.addClass(t)}),p+=1,r.attr("tabindex",p),i.disabled?(o.addClass("xmuiMenuItemDisabled"),r.attr("aria-disabled","true")):s?(r.attr("aria-label",n("aria.setDefaultMethod").replace("$name",i.title)),r.click(function(){nt.attr("aria-hidden","true"),nt.fadeOut(function(){l({method:i.method.type,action:e.ConfigMenuActions.SetDefault})})})):(r.attr("aria-label",i.title),r.click(function(){nt.attr("aria-hidden","true"),nt.fadeOut(function(){l(i)})})),o=m(i,o,p),nt.find(".xmuiMenuItems").append(o)}),u?at.click(function(){nt.attr("aria-hidden","true"),d(e.CancelFlowActions.Cancel)}):at.hide(),c(),x(),v(nt,nt.find(".xmuiMenuItems").first(".xmuiMenuItem"))})}function b(t){return t.type?"otp"===t.type?n("methodName."+t.type).replace("$channel",n("otpMethodChannel."+t.channels[0].type)):n("registration"===t.type?"methodName."+t.method:"methodName."+t.type):n("methodName."+t)}function P(t){return n("authMenu.methodTitle").replace("$method",b(t))}function C(t,e){function i(t){var e=[];return t.isDefault&&e.push("xmuiMethodMenuAnnDefault"),t.locked&&e.push("xmuiMethodMenuAnnLocked"),e}var o=t.map(function(t){return{disabled:t.disabled,classes:["xmuiMethodMenuItem","xmuiMethodMenu_"+t.type],annunciators:i(t),title:P(t),method:t}});return g(o,n("authMenu.title"),n("authMenu.selectAuthenticator"),null,null,!0).then(function(t){return t.method})}function A(t,e){function i(t){var e=[];return t.isDefault&&e.push("xmuiMethodMenuAnnDefault"),t.locked&&e.push("xmuiMethodMenuAnnLocked"),"registered"===t.status?(e.push("xmuiMethodMenuAnnReRegister"),e.push("xmuiMethodMenuAnnUnregister")):e.push("xmuiMehtodMenuAnnRegister"),t.expired&&e.push("xmuiMehtodMenuAnnExpired"),e}var o=t.map(function(t){return{method:t,title:b(t),classes:["xmuiMethodMenuItem","xmuiMethodMenu_"+t.type],annunciators:i(t),registered:"registered"===t.status,expired:t.expired,locked:t.locked,disabled:t.disabled}});return g(o,n("configMenu.title"),n("configMenu.instructions"),null,!0)}function S(e,i){function n(){pt.empty(),e.selectable_devices.forEach(function(e){var i=t("<input/>").attr({id:"xmui_device_"+e.device_id,name:"xmui_device_"+e.device_id,type:"checkbox"}).data("xmui_device_id",e.device_id),n=[];void 0!==e.alias&&n.push(e.alias,": "),n.push(e.model," last accessed on: ",new Date(e.last_access).toLocaleString());var n=[];void 0!==e.alias&&n.push(e.alias,": "),n.push(e.model," last accessed on: ",new Date(e.last_access).toLocaleString());var o=t("<label/>").attr("htmlFor","xmui_device_"+e.device_id).text(n.join("")).css("font-size","10pt");pt.append(i).append(o).append(t("<br/>"))})}return d(),new Promise(function(i,o){x(),n(),xt.click(function(){var e=[],n=mt.find("input:checkbox:checked");n.each(function(i,n){e.push(t(n).data("xmui_device_id"))}),e.length<=0?alert("no device selected - cannot continue with mobile approve"):mt.fadeOut(function(){i(e)})}),f(mt,b(e)),Q(mt,i,!0),c(),v(mt)})}function k(t,e){return d(),new Promise(function(e,i){x(),lt.text(t.instructions),t.otp?"qrcode"==t.otp.format.type?ct.show().attr("src","data:image/jpeg;base64,"+t.otp.value):dt.show().text(t.otp.value):t.otp_code&&dt.show().text(t.otp_code),f(ut,b(t)),Q(ut,e,!0),c(),v(ut)})}function I(t,e){return d(),new Promise(function(e,i){require(["xm/xmrecorder"],function(i){Lt.text(t.passphrase_text);var o={vizCanvas:Ht.get(0)};Object.assign(o,M.voiceRecorder),Dt||(Dt=new i.Recorder(o)),Dt.setOnEndRecording(function(i){function n(t){for(var e="",i=new Uint8Array(t),n=i.byteLength,o=0;o<n;o++)e+=String.fromCharCode(i[o]);return window.btoa(e)}_t.hide(),m();var o={sample:n(i.getPcm16().buffer),passphrase_text:t.passphrase_text};e(o)}),Nt.show(),Nt.attr("role","Button").attr("aria-label",n("aria.voiceRecordButton")),_t.find(".xmuiAudioAnalyzer").hide(),x(),f(_t,b(t)),Q(_t,e,!0),c(),v(_t)})})}function F(t,e){return d(),new Promise(function(e,i){x(),kt.text(n("password.prompt")),At.val(""),At.attr("role","textbox").attr("aria-label",n("aria.enterPassword")),St.text(n("password.loginButton")),St.click(function(){var t={password:At.val()};Ct.fadeOut(function(){e(t)})}),f(Ct,b(t)),Q(Ct,e,!0),c(),v(Ct,At)})}function O(t,e){d();var i;return new Promise(function(e,o){function a(){if(i===At.val()){var t={password:At.val()};Ct.fadeOut(function(){e(t)})}else kt.text(n("password.registration.noMatch")),kt.addClass("xmuiPromptError"),At.val(""),At.attr("role","textbox").attr("aria-label",n("aria.passwordsDontMatch"))}function s(){i=At.val(),kt.text(n("password.registration.promptAgain")),At.val(""),At.attr("role","textbox").attr("aria-label",n("aria.enterPasswordAgain")),St.text(n("password.registration.registerButton")),r(St,a)}x(),kt.text(n("password.registration.prompt")),At.val(""),At.attr("role","textbox").attr("aria-label",n("aria.enterPassword")),St.text(n("password.registration.continueButton")),St.click(s),f(Ct,b(t)),Q(Ct,e,!0),c(),v(Ct,At)})}function B(t,e){return d(),new Promise(function(e,i){x(),Ft.val(""),Ot.click(function(){var t={otp:Ft.val()};It.hide(function(){e(t)})}),Bt.click(function(){var t={command:"resend"};It.hide(function(){it.fadeIn(),e(t)})}),f(It,b(t)),Q(It,e,!0),c(),v(It,Ft)})}function R(e,i){return d(),new Promise(function(i,n){Rt.find(".xmuiOtpTargetSelectionItem").remove(),x();var o=e.channels[0];t.each(o.targets,function(e,n){var o=t('<div class="xmuiMenuItem xmuiOtpTargetSelectionItem">').text(n).click(function(){Rt.fadeOut(function(){i(e)})});Rt.find(".xmuiOtpTargetSelectionList").append(o)}),f(Rt,b(e)),Q(Rt,i,!0),c(),v(Rt)})}function E(e,i){return d(),new Promise(function(i,n){x(),require(["xm/md5"],function(n){var o=Object.keys(e.question)[0],r=t("<input/>").attr({id:"xmui_question_"+o,name:"xmui_question_"+o,type:"text",autocomplete:"off"}).data("xmui_question_id",o),a=t("<label/>").attr("htmlFor","xmui_question_"+o).text(e.question[o]+" ? ").css("font-size","10pt");$t.append(a).append(r).append(t("<br/>")),jt.click(function(){qt.fadeOut(function(){var e={answer:{}},r=t("#xmui_question_"+o);e.answer[o]=n(r.val()),i(e)})}),f(qt,b(e)),Q(qt,i,!0),c(),v(qt,r)})})}function U(e,i){var n={},o=[];return d(),new Promise(function(i,r){require(["xm/md5"],function(r){x(),$t.empty(),Object.keys(e.questions).forEach(function(i){var n=t("<input/>").attr({id:"xmui_question_"+i,name:"xmui_question_"+i,type:"text",autocomplete:"off"}).data("xmui_question_id",i),o=t("<label/>").attr("htmlFor","xmui_question_"+i).text(e.questions[i].text+" ? ").css("font-size","10pt");$t.append(o).append(n).append(t("<br/>"))}),jt.click(function(){Object.keys(e.questions).forEach(function(e){var i=t("#xmui_question_"+e).val();i?n[e]=r(i):o.push(e)}),qt.fadeOut(function(){i({deleted_answers:o,answers:n})})}),f(qt,b(e)),Q(qt,i,!0),c(),v(qt,$t.find("input:first"))})})}function T(t,e){return d(),new Promise(function(e,i){x(),Ut.val(""),Tt.click(function(){var t={totp:Ut.val()};Et.fadeOut(function(){e(t)})}),f(Et,b(t)),Q(Et,e,!0),c(),v(Et)})}function _(t,e){return d(),new Promise(function(e,i){x(),vt.text(n("mobilePin.authPending")),ht.text(t.instructions),f(ft,b(t)),Q(ft,e,!0),c(),v(ft)})}function L(t,e){return d(),new Promise(function(e,i){x(),vt.text(n("mobilePin.registrationPending")),ht.text(n("mobilePin.registrationInstructions")),f(ft,b(t)),Q(ft,e,!1),c(),v(ft)})}function H(t,e){return d(),new Promise(function(e,i){x(),bt.val(""),Pt.click(function(){var t={mobile:bt.val()};gt.fadeOut(function(){e(t)})}),f(gt,b(t)),Q(gt,e,!1),c(),v(gt)})}function N(t,e){return d(),new Promise(function(e,i){function o(){var t=[{classes:["xmuiMethodMenuItem"],title:n("mobilePin.loginWith")+r,onSelect:function(){e({mobile:r})}}];g(t,n("methodName.mobile_pin"),n("mobilePin.authCfmMobilePrompt")).then(function(t){t.onSelect()})}var r=t.mobile;x(),r&&"unknown"!=r?o():(wt.val(""),Mt.click(function(){r=wt.val(),o()}),c(),v(yt)),f(yt,b(t)),Q(yt,e,!0)})}function D(t,e,i){return e(t.map(function(t){var e=Math.floor((t-1)/i.columns),n=(t-1)%i.columns;return"r:"+e+",c:"+n}).join(""))}function q(t,e){return d(),new Promise(function(e,i){require(["xm/md5","xm/patternLock"],function(i){x();var n={rows:4,columns:3};Object.assign(n,M.patternMatrix),new PatternLock(".xmuiAuthPatternControl",{matrix:[n.rows,n.columns],onDraw:function(t){var o=JSON.parse("["+t+"]");Jt.fadeOut(function(){e({secret:D(o,i,n)})})}}),f(Jt,b(t)),Q(Jt,e,!0),c(),v(Jt)})})}function $(t,e){return d(),new Promise(function(i,o){require(["xm/md5","xm/patternLock"],function(o){function a(){h.reset(),Vt.attr("disabled",!0),zt.removeClass("xmuiPromptError"),zt.text(n("pattern.registerDrawAgainPrompt")),d=s,m=D(p,o,l)}function s(){m===D(p,o,l)?Kt.fadeOut(function(){i({secret:m})}):(h.reset(),Vt.attr("disabled",!0),zt.addClass("xmuiPromptError"),zt.text(n("pattern.registerNoMatchErrorPrompt")))}function u(){p.length<t.min_length?(zt.addClass("xmuiPromptError"),zt.text(n("pattern.registerTooShortErrorPrompt").replace("$length",t.min_length)),h.reset()):d()}var l={rows:4,columns:3};Object.assign(l,M.patternMatrix);var d=a,m=null,p=null,h=new PatternLock(".xmuiRegPatternControl",{matrix:[l.rows,l.columns],onDraw:function(t){p=JSON.parse("["+t+"]"),Vt.attr("disabled",!1)}});x(),zt.text(n("pattern.registerDrawPrompt")),Vt.attr("disabled",!0),r(Vt,u),Wt.click(function(){return zt.removeClass("xmuiPromptError"),$(t,e)}),f(Kt,b(t)),Q(Kt,i,!1),c(),v(Kt)})})}function j(t,e){return d(),new Promise(function(e,i){require(["xm/md5"],function(i){x(),Yt.val(""),Gt.click(function(){var t={secret:i(Yt.val())};Qt.fadeOut(function(){e(t)})}),Xt.text(n("pin.prompt")),f(Qt,b(t)),Q(Qt,e,!0),c(),v(Qt,Yt)})})}function J(t,e){d();var i;return new Promise(function(e,o){require(["xm/md5"],function(o){function a(){if(i===Yt.val()){Xt.removeClass("xmuiPromptError");var t={secret:o(Yt.val())};Qt.fadeOut(function(){e(t)})}else Xt.text(n("pin.registration.noMatch")),Xt.addClass("xmuiPromptError"),Yt.val(""),Yt.attr("role","textbox").attr("aria-label",n("aria.pinsDontMatch"))}function s(){var e=Yt.val();e.length==t.length?(i=e,Xt.text(n("pin.registration.promptAgain")),Xt.removeClass("xmuiPromptError"),Yt.val(""),Yt.attr("role","textbox").attr("aria-label",n("aria.enterPinAgain")),Gt.text(n("pin.registration.registerButton")),r(Gt,a)):(Xt.text(n("pin.registration.badLength").replace("$length",t.length)),Xt.addClass("xmuiPromptError"),Yt.val(""),Yt.attr("role","textbox").attr("aria-label",n("aria.badPinLength").replace("$length",t.length)))}x(),Xt.text(n("pin.registration.prompt")),Yt.val(""),Yt.attr("role","textbox").attr("aria-label",n("aria.enterPin")),Gt.text(n("pin.registration.continueButton")),r(Gt,s),f(Qt,b(t)),Q(Qt,e,!0),c(),v(Qt,Yt)})})}function K(t,i,o,r){var a,s=[e.AssertionErrorHandlerResponse.Fail];if(i)s.unshift(e.AssertionErrorHandlerResponse.RetryMethod),a=p(o.regFailureReason);else{s.unshift(e.AssertionErrorHandlerResponse.RetryAction);var u=t.data&&t.data.data&&t.data.data.locked;a=u?n("recoveryMenu.locked"):n("recoveryMenu.failed").replace("$reason",p(t.data)),u||s.unshift(e.AssertionErrorHandlerResponse.RetryMethod)}var l=s.map(function(t){return{classes:["xmuiAuthRecoveryMenuItem","xmuiRecoveryMenu_"+t.toString()],title:n("failureAction."+t.toString()),resp:t}});return g(l,n("recoveryMenu.title"),null,a).then(function(t){return t.resp})}function z(t,e,i){return K(t,!1,e,i)}function W(t,e,i){return K(t,!0,e,i)}function V(t){var i=[e.CancelFlowActions.Cancel,e.CancelFlowActions.Retry];t&&i.push(e.CancelFlowActions.ChangeMethod);var o=i.map(function(t){return{classes:["xmuiCancelActionMenuItem","xmuiCancelMenu_"+t.toString()],title:n("cancelMenu."+t.toString()),resp:{cancelAction:t}}});return g(o,n("cancelMenu.title"),n("cancelMenu.instructions")).then(function(t){return t.resp})}function Q(t,i,n){t.find(".xmuiPageHeader").find("button").click(function(){t.fadeOut(function(){i(n?{cancelAction:e.CancelFlowActions.CancelWithChangeMethodRequested}:{cancelAction:e.CancelFlowActions.CancelRequested})})})}function Y(t,i,n,o,r){return d(),new Promise(function(r,a){x(),Zt.find(".xmuiConfirmationTitle").text(t),Zt.find(".xmuiConfirmationText").text(i);var s=Zt.find(".xmuiConfirmationContinueButton");s.text(n),s.click(function(){Zt.fadeOut(function(){r(e.ConfirmationActions.Continue)})});var u=Zt.find(".xmuiConfirmationCancelButton");u.text(o),u.click(function(){Zt.fadeOut(function(){r(e.ConfirmationActions.Cancel)})}),c(),v(Zt)})}function G(t,e,i,n){return d(),new Promise(function(n,o){x(),te.find(".xmuiInformationTitle").text(t),te.find(".xmuiInformationText").text(e);var r=te.find(".xmuiInformationButton");r.text(i),r.click(function(){te.fadeOut(function(){n()})}),c(),v(te)})}function X(t,e,i,n,o){return G(t,e,i,o)}function Z(t,i,n){return d(),new Promise(function(t,i){x();var n=ee.find(".xmuiMethodFallbackContinueButton");n.click(function(){ee.fadeOut(function(){t(e.ConfirmationActions.Continue)})});var o=ee.find(".xmuiMethodFallbackCancelLink");o.click(function(){ee.fadeOut(function(){t(e.ConfirmationActions.Cancel)})}),c(),v(ee)})}function tt(t){return Y(n("unregister.confirmation.title"),n("unregister.confirmation.instructions").replace("$method",b(t)),n("unregister.confirmation.continue"),n("unregister.confirmation.cancel"))}function et(i,n,o){m();var r={ui_container:n,uid:i};return o(e,y,i,r).then(function(e){return t(n).children().hide(),m(),e},function(t){return x(),Promise.reject(t)})}a=t(a),a.attr("aria-live","assertive"),d();var it=t('<div class="xmuiCore xmuiForm xmuiProgressForm" hidden style="display:none"><div class="xmuiSpinner"/><span style="vertical-align:middle" data-xmui-customstringtext="progress.pleaseWait"></span></div>'),nt=t('<div class="xmuiCore xmuiForm xmuiMenuForm" role="dialog" aria-labelledby="xmuiMenuTitle" aria-describedby="xmuiMenuInstructions" aria-hidden="true" style="display:none"><div class="xmuiPageHeader"><div><span id="xmuiMenuTitle"></span><button data-xmui-customstringtext="login.cancelButton"></button></div></div><h1 id="xmuiMenuInstructions" class="xmuiPrompt"/><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiMenuItems" role="menu"></div></div></div>'),ot=nt.find(".xmuiPageHeader"),rt=ot.find("span"),at=ot.find("button"),st=nt.find(".xmuiPrompt"),ut=t('<div class="xmuiCore xmuiForm xmuiMobileAuthForm" hidden style="display:none"><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiHalfHeight"><span class="xmuiHalfHeightText" data-xmui-customstringtext="mobileAuth.approvalPending"/></div><div class="xmuiLoginInstructionsLabel"></div><div class="xmuiOtpText" hidden style="display:none"></div><img class="xmuiOtpImg" hidden style="display:none"/><div class="xmuiSpinner"></div></div></div>'),lt=ut.find(".xmuiLoginInstructionsLabel"),dt=ut.find(".xmuiOtpText"),ct=ut.find(".xmuiOtpImg"),mt=t('<div class="xmuiCore xmuiForm xmuiMobileAuthSelectDeviceForm" hidden style="display:none"><div><h1 data-xmui-customstringtext="mobileAuthDeviceSelection.selectDevices"/><div class="xmuiAuthMobileDeviceSelectionList"></div></div></div>'),pt=mt.find(".xmuiAuthMobileDeviceSelectionList"),xt=t('<button type="button" data-xmui-customstringtext="mobileAuthDeviceSelection.select"/>').appendTo(mt),ft=t('<div class="xmuiCore xmuiForm xmuiMobilePinPendingForm" hidden style="display:none"><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiHalfHeight"><div class="xmuiHalfHeight"><span class="xmuiHalfHeightText"></span></div><div><div class="xmuiLoginInstructionsLabel xmuiHalfHeightText"></div></div></div><div class="xmuiSpinner"></div></div></div>'),vt=ft.find("span"),ht=ft.find(".xmuiLoginInstructionsLabel"),gt=t('<div class="xmuiCore xmuiForm xmuiMobilePinRegForm" hidden style="display:none"><div class="xmuiPrompt" data-xmui-customstringtext="mobilePin.registerPrompt"/><div class="xmuiFullHeightContentBelowPrompt"><div><input data-xmui-customstringtext-placeholder="mobilePin.registerInputPlaceholder"/></div><div><button type="button" data-xmui-customstringtext="mobilePin.registerSubmitButton"/></div></div></div>'),bt=gt.find("input"),Pt=gt.find("button"),yt=t('<div class="xmuiCore xmuiForm xmuiMobilePinAuthForm" hidden style="display:none"><div class="xmuiPrompt" data-xmui-customstringtext="mobilePin.authTitle"/><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiMobilePinAuthFormAskSection"><div class="xmuiPrompt" data-xmui-customstringtext="mobilePin.authAskMobilePrompt"/><div><span class="xmuiMobilePinAuthFormPhonePrefix">**********</span><input data-xmui-customstringtext-placeholder="mobilePin.authAskMobileInputPlaceholder"/></div><div><button type="button" class="xmuiMobilePinAskSubmitButton" data-xmui-customstringtext="mobilePin.authAskSubmitButton"/></div></div></div></div>'),Mt=yt.find(".xmuiMobilePinAskSubmitButton"),wt=yt.find(".xmuiMobilePinAuthFormAskSection input"),Ct=t('<div class="xmuiCore xmuiForm xmuiPasswordForm" hidden style="display:none"><div class="xmuiPrompt"/><div class="xmuiFullHeightContentBelowPrompt"><form onsubmit="return false"><div><input type="password" data-xmui-customstringtext-placeholder="password.inputPlaceholder"/></div><div><button type="submit"/></div></form></div></div>'),At=Ct.find("input"),St=Ct.find("button"),kt=Ct.find(".xmuiPrompt"),It=t('<div class="xmuiCore xmuiForm xmuiOtpForm" hidden style="display:none"><div class="xmuiPrompt" data-xmui-customstringtext="otp.prompt"/><div class="xmuiFullHeightContentBelowPrompt"><form onsubmit="return false"><input data-xmui-customstringtext-placeholder="otp.inputPlaceholder"/><div style="align-items: center;"><button class="xmuiLoginButton" type="submit" data-xmui-customstringtext="otp.loginButton"/><br><button class="xmuiResendButton" type="button" data-xmui-customstringtext="otp.resendButton"/></div></form></div></div>'),Ft=It.find("input"),Ot=It.find(".xmuiLoginButton"),Bt=It.find(".xmuiResendButton"),Rt=t('<div class="xmuiCore xmuiForm xmuiOtpTargetSelectionForm" hidden style="display:none"><div class="xmuiOtpTargetSelectionList"><h1 data-xmui-customstringtext="otpTargetSelection.selectTarget"/></div></div>'),Et=t('<div class="xmuiCore xmuiForm xmuiTotpForm" hidden style="display:none"><table><tr><td style="width:100%"><input data-xmui-customstringtext-placeholder="totp.inputPlaceholder"/></td></tr><tr><td><button type="button" data-xmui-customstringtext="totp.loginButton"/></td></tr></table></div>'),Ut=Et.find("input"),Tt=Et.find("button"),_t=t('<div class="xmuiCore xmuiForm xmuiVoiceForm" hidden style="display:none"><div class="xmuiPrompt" data-xmui-customstringtext="voice.prompt"/><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiVoicePassphrase"/><div class="xmuiAudioAnalyzer" hidden style="display:none"><canvas width="120" height="120"/></div><div class="xmuiAudioControls"><button type="button" data-xmui-customstringtext="voice.startButton"/></div></div></div>'),Lt=_t.find(".xmuiVoicePassphrase"),Ht=_t.find("canvas"),Nt=_t.find(".xmuiAudioControls button"),Dt=null;_t.find("button").click(function(){_t.find("button").hide(),_t.find(".xmuiAudioAnalyzer").show(),Dt.record()}),Ht.click(function(){Dt.stop()});var qt=t('<div class="xmuiCore xmuiForm xmuiQuestionForm" hidden style="display:none"><div class="xmuiPrompt" data-xmui-customstringtext="question.prompt"/><div class="xmuiFullHeightContentBelowPrompt"><form onsubmit="return false"><div class="xmuiQuestionsContainer"></div><div><button type="submit" data-xmui-customstringtext="question.submitButton"/></div></form></div></div>'),$t=qt.find(".xmuiQuestionsContainer"),jt=qt.find("button"),Jt=t('<div class="xmuiCore xmuiForm xmuiPatternForm" hidden style="display:none"><div class="xmuiPrompt" data-xmui-customstringtext="pattern.prompt"/><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiPatternControl xmuiAuthPatternControl"/></div></div>'),Kt=t('<div class="xmuiCore xmuiForm xmuiPatternForm" hidden style="display:none"><div class="xmuiPrompt"/><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiPatternControl xmuiRegPatternControl"/><div><button class="xmuiPatternRegRestartButton" data-xmui-customstringtext="pattern.registerRestartButton"></button><button class="xmuiPatternRegContinueButton" data-xmui-customstringtext="pattern.registerContinueButton"></button></div></div></div>'),zt=Kt.find(".xmuiPrompt"),Wt=Kt.find(".xmuiPatternRegRestartButton"),Vt=Kt.find(".xmuiPatternRegContinueButton"),Qt=t('<div class="xmuiCore xmuiForm xmuiPinForm" hidden style="display:none"><div class="xmuiPrompt"/><div class="xmuiFullHeightContentBelowPrompt"><form onsubmit="return false"><ul class="xmuiTable"><li class="xmuiTableRow"><input class="xmuiTableCell" data-xmui-customstringtext-placeholder="pin.inputPlaceholder"/></li><li class="xmuiTableRow"><button class="xmuiTableCell" type="submit" data-xmui-customstringtext="pin.loginButton"/></li></ul></form></div></div>'),Yt=Qt.find("input"),Gt=Qt.find("button"),Xt=Qt.find(".xmuiPrompt"),Zt=t('<div class="xmuiCore xmuiForm xmuiConfirmationForm" hidden style="display:none"><div class="xmuiPageHeader"><div><span class="xmuiConfirmationTitle"></span></div></div><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiConfirmationText"/><br/><div><button class="xmuiConfirmationContinueButton" type="button"/><button class="xmuiConfirmationCancelButton" type="button"/></div></div></div>'),te=t('<div class="xmuiCore xmuiForm xmuiInformationForm" hidden style="display:none"><div class="xmuiPageHeader"><div><span class="xmuiInformationTitle"</span></div></div><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiInformationText"/><br/><div><button class="xmuiInformationButton" type="button"/></div></div></div>'),ee=t('<div class="xmuiCore xmuiForm xmuiConfirmationForm" hidden style="display:none"><div class="xmuiMethodFallbackText" data-xmui-customstringtext="methodFallback.text"></div><div><button class="xmuiMethodFallbackContinueButton" type="button" role="button" data-xmui-customstringtext="methodFallback.button"/></div><div><a href="#" class="xmuiMethodFallbackCancelLink" role="link" data-xmui-customstringtext="methodFallback.link"/></div></div>'),ie=[ut,mt,Ct,It,Rt,_t,Et,qt,yt,gt,ft,Jt,Kt,Qt],ne=[it,nt,Zt,te,ee].concat(ie);return w={methodMenu2:C,configMenu:A,password:{input:F,registrationInput:O},voice:I,otp:{"input.numeric":B,targetSelection:R},otpSelect:R,mobileApprove:{input:k,deviceSelection:S},mobileApproveSelect:S,totp:{input:T,deviceSelection:S},question:{input:E,recover:function(){return Promise.resolve(e.AssertionErrorHandlerResponse.Fail)},registrationInput:U},mobilePin:{input:N,pending:_,registrationInput:H,registrationPending:L,recover:function(){return Promise.resolve(e.AssertionErrorHandlerResponse.Fail)}},pattern_centralized:{input:q,registrationInput:$},pin_centralized:{input:j,registrationInput:J}},M.authenticationMethodPromiseOverrides&&M.authenticationMethodPromiseOverrides.otp&&(M.authenticationMethodPromiseOverrides.otp instanceof Function?M.authenticationMethodPromiseOverrides.otp={input:{numeric:M.authenticationMethodPromiseOverrides.otp}}:M.authenticationMethodPromiseOverrides.otp.input&&M.authenticationMethodPromiseOverrides.otp.input instanceof Function&&(M.authenticationMethodPromiseOverrides.otp.input={numeric:M.authenticationMethodPromiseOverrides.otp.input})),Object.assign(w,M.authenticationMethodPromiseOverrides),e.setAuthenticationMethodInputPromises(w),e.setAuthenticationMethodFailureRecoveryPromise(M.assertionErrorHandler||z),e.setMethodRegistrationFailureRecoveryPromise(M.assertionErrorHandler||W),e.setConfirmationInputPromise(Y),e.setAuthenticationRejectionInputPromise(X),e.setInformationInputPromise(G),e.setConfirmMethodFallbackInputPromise(Z),e.setUnregistrationConfirmationInputPromise(tt),e.setCancelActionMenuPromise(V),u||(u=function(t,e,i,n){return t.promiseAuthenticationResult(e.aid,i,e.policy,e.additionalParams,n)}),i?(h(a),et(i,a,u)):l(a).then(function(t){return a.empty(),s(t,a,u)})}function u(t){var i=M.userHistoryLength||3,n=d();if(n.length){var o=n.indexOf(t);o>=0&&n.splice(o,1),n.length>i-1&&n.splice(i-1,n.length)}n.unshift(t),e.LocalStorage.setItem(e.LocalStorage.usersHistoryKey,JSON.stringify(n))}function l(i){function r(){i.attr("aria-busy","true")}function a(){i.removeAttr("aria-busy")}i=t(i);var s=t('<div hidden style="display:none"><div class="xmuiPageHeader"><div><span data-xmui-customstringtext="user.management.title"></span><button data-xmui-customstringtext="user.management.cancelButton"></button></div></div><div class="xmuiMenuItems"><ul class="xmuiTilesList xmuiLoginTiles xmuiUsersList" role="menu"><li class="xmuiLoginLabel" role="menuitem"><h1 class="xmuiLoginTitle xmuiOtherUser">Other</h1></li></ul></div></div>'),u=t('<div hidden style="display:none"><div class="xmuiPageHeader"><div><span data-xmui-customstringtext="newUser.title"></span><button data-xmui-customstringtext="newUser.cancelButton"></button></div></div><div class="xmuiForm""><form onsubmit="return false"><div class="xmuiNewUserFormItem" align="center"><div class="xmuiInputUserNameParent"><input class="xmuiInputUserName" placeholder="User Name"/><br><input id="xmuiRememberUserCheckbox" class="xmuiRememberUserCheckbox" type="checkbox"><label class="xmuiRememberUserLabel"" data-xmui-customstringtext="newUser.remember" for="xmuiRememberUserCheckbox"></label></div></div><div class="xmuiNewUserFormItem" align="center"><div><button type="submit" class="xmuiNameSubmitButton">Login</button></div></div></form></div></div>'),l=u.find(".xmuiInputUserName"),m=t('<div class="xmuiCore xmuiForm xmuiConfirmationForm" hidden style="display:none"><div class="xmuiPageHeader"><div><span class="xmuiConfirmationTitle" data-xmui-customstringtext="removeUser.title"></span></div></div><div class="xmuiFullHeightContentBelowPrompt"><div class="xmuiConfirmationText"/><br/><div><button class="xmuiConfirmationContinueButton" type="button" data-xmui-customstringtext="removeUser.continue"/><button class="xmuiConfirmationCancelButton" type="button" data-xmui-customstringtext="removeUser.cancel"/></div></div></div>');return s.find(".xmuiPageHeader").find("button").click(function(){window.location.reload()}),u.find(".xmuiPageHeader").find("button").click(function(){window.location.reload()}),m.find(".xmuiPageHeader").find("button").click(function(){window.location.reload()}),new Promise(function(p,x){function f(){var i=t(this).text();e.SessionStorage.setItem(e.SessionStorage.pendingUserKey,JSON.stringify({user:i,remember:!0})),s.fadeOut(function(){p(i)})}function v(t){r(),m.find(".xmuiConfirmationText").text(n("removeUser.text").replace("$user",t)),m.find(".xmuiConfirmationContinueButton").click(function(){m.fadeOut(function(){c(t).then(p)})}),m.find(".xmuiConfirmationCancelButton").click(function(){m.fadeOut(p)}),a(),m.fadeIn()}function h(){function n(t,i){e.SessionStorage.setItem(e.SessionStorage.pendingUserKey,JSON.stringify({user:t,remember:i})),u.fadeOut(function(){p(t)})}i.attr("aria-busy","true"),t(".xmuiNameSubmitButton").click(function(){var e=l.val(),i=t(".xmuiRememberUserCheckbox")[0].checked;if(M.validateUsername){var o=M.validateUsername(e);o.valid?n(e,i):alert(o.error)}else n(e,i)}),l.val(""),s.fadeOut(function(){i.removeAttr("aria-busy"),u.fadeIn(function(){l.focus()})})}function g(e){i.attr("aria-busy","true"),e.reverse().forEach(function(e){var i=t("<div>").addClass("xmuiLoginTitle"),o=t("<span>").addClass("xmuiExistingUser").text(e).attr("role","menuitem").attr("tabindex","1").attr("aria-label",n("aria.existingUser").replace("$name",e)).click(f),r=t("<div>").addClass("xmuiExistingUserDelete").attr("role","button").attr("tabindex","2").attr("aria-label",n("aria.deleteExistingUser").replace("$name",e)).click(function(){s.fadeOut(function(){v(e)})});i.append(o),i.append(r),t(".xmuiUsersList").prepend(t("<li>").addClass("xmuiLoginLabel").append(i))}),t(".xmuiOtherUser").attr("role","menuitem").attr("tabindex","2").attr("aria-label",n("aria.newUser")).click(h),i.removeAttr("aria-busy"),s.fadeIn()}function b(){t(".existingUser").remove();var e=d();e.length?g(e):h()}i.empty(),i.append(u),i.append(s),i.append(m),o(),b()})}function d(){var t=e.LocalStorage.getItem(e.LocalStorage.usersHistoryKey);return t?JSON.parse(t):[]}function c(t){return new Promise(function(i,n){e.deleteUserData(t),e.SessionStorage.removeItem(e.SessionStorage.pendingUserKey);var o=d(),r=o.indexOf(t);r>-1?(o.splice(r,1),e.LocalStorage.setItem(e.LocalStorage.usersHistoryKey,JSON.stringify(o)),i("OK")):n("Requested to remove user ["+t+"] which is not in history: "+JSON.stringify(o))})}function m(){var t=JSON.parse(e.SessionStorage.getItem(e.SessionStorage.pendingUserKey));if(t)return t.user;var i=d();return i&&i.length?(t=i[0],e.SessionStorage.setItem(e.SessionStorage.pendingUserKey,JSON.stringify({user:t,remember:!0})),t):null}function p(t){var e;return t.assertion_error_code&&(e=C["error.assertion_error_code."+t.assertion_error_code]),
e||t.xmapiError&&(e=C["error.xmapiError."+t.xmapiError.toString()],t.xmapiErrorReplacements&&Object.keys(t.xmapiErrorReplacements).forEach(function(i){e=e.replace(i,t.xmapiErrorReplacements[i])})),e||(e=JSON.stringify(t)),e}function x(e,i,n){return n=t(n),e.then(function(t){return t.jsonData&&t.jsonData.mode&&"enroll"==t.jsonData.mode?a(i,n):t})}function f(e,i,n,o){return i=t(i),s(e,i,function(t,e,i,r){return t.promiseAuthenticationResult(e.aid,i,n||e.policy,o||e.additionalParams,r).then(function(e){var i=JSON.parse(t.SessionStorage.getItem(t.SessionStorage.pendingUserKey));return i&&i.remember&&u(i.user),e})})}function v(e,i,n,o,r,a){return r=t(r),s(e,r,function(t,e,r,s){return t.promiseRegistrationResult(e.aid,r,i,n,o,a||e.additionalParmas,s)})}function h(e,i,n,o){return n=t(n),s(e,n,function(t,e,n,r){return t.promiseRegisterAuthenticatorResult(e.aid,n,i,o||e.additionalParmas,r)})}function g(e,i,n,o,r,a){return r=t(r),s(e,r,function(t,e,r,s){return t.promiseConfigMenuResult(e.aid,r,i,n,o,a||e.additionalParams,s)})}function b(e,i,n,o){return n=t(n),s(e,n,function(t,e,n,r){return t.promiseConfigMenuAction(e.aid,n,i,o||e.additionalParams,r)})}function P(t,i,n){return e.promiseLogout(y.aid,t,i,n||y.additionalParmas).then(function(t){var i=JSON.parse(e.SessionStorage.getItem(e.SessionStorage.pendingUserKey));return i&&(i.remember||c(i.user),e.SessionStorage.removeItem(e.SessionStorage.pendingUserKey)),Promise.resolve(t)})}var y={},M={},w={},C={"progress.pleaseWait":"Please wait...","authMenu.title":"Authentication","authMenu.selectAuthenticator":"Please select authentication method:","authMenu.methodTitle":"Authenticate with $method","configMenu.instructions":"Add, edit or remove authenticators","configMenu.title":"Authentication Options","password.inputPlaceholder":"Password","password.loginButton":"Sign In","password.prompt":"Please type your password","password.registration.prompt":"Please type a new password","password.registration.promptAgain":"Please type the new password again","password.registration.noMatch":"Passwords did not match. Try again","password.registration.continueButton":"Continue","password.registration.registerButton":"Confirm","question.prompt":"Please answer the following","question.submitButton":"Submit","otp.prompt":"Input OTP code","otp.inputPlaceholder":"Input code here","otp.loginButton":"Login","otp.resendButton":"Resend OTP","totp.prompt":"Input OTP code","totp.inputPlaceholder":"Input OTP code","totp.loginButton":"Login","enroll.prompt":"Please scan the QR code below to bind your device.","enroll.continue":"Continue","mobileAuth.approvalPending":"Approval pending...","mobileAuthDeviceSelection.selectDevices":"Select devices for mobile approve:","mobileAuthDeviceSelection.select":"Select","mobilePin.authPending":"Authentication pending...","mobilePin.registrationPending":"Waiting for completion of registration on your mobile device.","mobilePin.registrationInstructions":"Please complete registration on your mobile device.","mobilePin.registerPrompt":"Please type your mobile phone number","mobilePin.registerInputPlaceholder":"Mobile phone number","mobilePin.registerSubmitButton":"Register","mobilePin.authTitle":"Login with Clickable SMS","mobilePin.authAskMobilePrompt":"Please input the last 4 digits of your mobile device phone number to login","mobilePin.authAskMobileInputPlaceholder":"","mobilePin.authAskSubmitButton":"Continue","mobilePin.authCfmMobilePrompt":"Confirm login with your mobile device","mobilePin.loginWith":"Login with ******","otpTargetSelection.selectTarget":"Select target for OTP:","error.xmapiError.invalidPassword":"Invalid password provided","error.xmapiError.invalidTotp":"Invalid code provided","error.xmapiError.invalidPattern":"Invalid pattern provided","error.xmapiError.invalidPin":"Invalid PIN provided","error.xmapiError.invalidOtp":"Invalid OTP provided","error.xmapiError.invalidVoice":"Invalid voice provided","error.xmapiError.approvalDenied":"Mobile approval denied","error.xmapiError.approvalExpired":"Mobile approval expired","error.xmapiError.allAuthenticatorsLocked":"All authenticators are locked","error.xmapiError.noRegisteredAuthenticator":"No registered authenticator is available","error.xmapiError.commError":"Protocol error","error.xmapiError.authRejected":"Access was rejected by server","error.xmapiError.authActionError":"Error occured while handling authentication assertion action","error.xmapiError.secretAlreadyUsed":"Secret has already been used","error.xmapiError.notEnoughAnswers":"Must have at least $count answers","error.xmapiError.corsOrInvalidHost":"Destination server is invalid or the server does not support access-control-allow-origin","error.xmapiError.sessionExpired":"Session has expired","methodName.password":"Password","methodName.voice_server":"Voice Passphrase","methodName.otp":"OTP via $channel","methodName.totp":"Time-Based Token","methodName.mobile_approve":"Mobile Approve","methodName.mobile_pin":"Clickable SMS","methodName.question":"Memorable Question","methodName.pattern_centralized":"Pattern","methodName.pin_centralized":"Pin","otpMethodChannel.sms":"SMS","otpMethodChannel.email":"E-mail","otpMethodChannel.voice":"Voice","otpMethodChannel.none":"External Provider","pattern.prompt":"Draw your pattern below","pattern.registerDrawPrompt":"Please draw a new pattern","pattern.registerDrawAgainPrompt":"Please draw the pattern again to confirm","pattern.registerTooShortErrorPrompt":"Pattern must be at least $length points long","pattern.registerNoMatchErrorPrompt":"Pattern do not match, please try again","pattern.registerRestartButton":"Start Over","pattern.registerContinueButton":"Continue","pin.prompt":"Input Pin code","pin.inputPlaceholder":"Input Pin code","pin.loginButton":"Login","pin.registration.prompt":"Please type a new PIN","pin.registration.promptAgain":"Please type the new PIN again","pin.registration.noMatch":"PINs did not match. Try again","pin.registration.badLength":"PIN should be $length digits long","pin.registration.continueButton":"Continue","pin.registration.registerButton":"Confirm","recoveryMenu.failed":"Authentication failed: $reason","recoveryMenu.locked":"Authenticator locked.","recoveryMenu.title":"Recovery","failureAction.Fail":"Cancel","failureAction.RetryAction":"Change Authentication Method","failureAction.RetryMethod":"Retry","voice.prompt":"Please click the button below and speak the following phrase:","login.cancelButton":"Cancel","cancelMenu.title":"Cancel Action","cancelMenu.instructions":"Are you sure you want to cancel and go back?","cancelMenu.Cancel":"Yes","cancelMenu.Retry":"Try Again","cancelMenu.ChangeMethod":"Change Authentication Method","unregister.confirmation.title":"Unregister Authenticator","unregister.confirmation.instructions":"Are you sure you want to unregister $method authentication?","unregister.confirmation.continue":"Yes","unregister.confirmation.cancel":"Cancel","user.management.title":"User Management","user.management.cancelButton":"Cancel","newUser.title":"New User","newUser.cancelButton":"Cancel","newUser.remember":"Remember me on this computer","methodFallback.text":"Having trouble logging in? We have other authentication options you can choose from. If you continue failing you may get locked out so switching to another option is recommended.","methodFallback.button":"Switch to another option","methodFallback.link":"Go back and let me try again","removeUser.title":"Remove User","removeUser.text":"Are you sure you want to remove user: $user","removeUser.continue":"Yes","removeUser.cancel":"Cancel","aria.unregisterMethod":"Unregister $name","aria.reRegisterMethod":"Re-register $name","aria.registerMethod":"Register $name","aria.lockedMethod":"$name is locked","aria.expiredMethod":"$name has expired","aria.defaultMethod":"$name is set as default authentication method","aria.setDefaultMethod":"click to set $name as default authentication method","aria.existingUser":"Select existing user named: $name","aria.deleteExistingUser":"Delete saved user named: $name","aria.newUser":"Add a new user","aria.enterPassword":"Enter a new password","aria.enterPasswordAgain":"Enter new password again","aria.passwordsDontMatch":"Passwords don't match. Try again","aria.voiceRecordButton":"Start recording voice","aria.enterPin":"Enter a new PIN","aria.enterPinAgain":"Enter new PIN again","aria.pinsDontMatch":"Passwords don't match. Try again","aria.badPinLength":"Pin should be $length digits long"};return{configure:i,promiseChangeCurrentUser:l,getCurrentUser:m,getUserHistory:d,removeUser:c,withEnrollmentSupport:x,errorToString:p,startInlineUi:s,startAuthUi:f,startRegisterUi:v,startRegistrationUi:h,startConfigMenuUi:g,startConfigurationMenuUi:b,logout:P}});